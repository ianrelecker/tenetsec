# TenetSec Usage Guide

This guide explains how to use TenetSec effectively to assess and improve the security of your Microsoft 365 tenant.

## Running an Assessment

After [setting up TenetSec](setup.md), you can run a full security assessment with:

```bash
python -m tenetsec.main
```

Or if you installed via pip with the entry point:

```bash
tenetsec
```

This will run all security assessments and generate reports in all available formats (console, JSON, and HTML).

### Specifying Assessments

You can run specific assessments instead of the full suite:

```bash
python -m tenetsec.main --assessment identity defender
```

Available assessment modules:
- `identity`: Assesses Microsoft Entra ID (Azure AD) security
- `defender`: Assesses Microsoft Defender for Office 365 security
- `exchange`: Assesses Exchange Online security
- `sharepoint`: Assesses SharePoint Online and OneDrive security
- `teams`: Assesses Microsoft Teams security
- `all`: Run all assessments (default)

### Report Formats

TenetSec can generate reports in several formats:

```bash
python -m tenetsec.main --format html
```

Available formats:
- `console`: Displays results in the terminal
- `json`: Creates a detailed JSON report file
- `html`: Creates a visual HTML report with charts
- `all`: Generates all report types (default)

### Output Directory

By default, report files are saved to a `reports` directory. You can specify a different location:

```bash
python -m tenetsec.main --output-dir /path/to/reports
```

### Configuration File

If you have multiple configuration files (for different tenants, for example), you can specify which one to use:

```bash
python -m tenetsec.main --config tenant2-config.json
```

## Understanding Assessment Results

The security assessment evaluates your M365 tenant across multiple security dimensions and provides:

1. An overall security score
2. Results by security category
3. AI-powered recommendations with implementation guidance
4. Detailed findings with recommendations

### Severity Levels

Findings are categorized by severity:

- **CRITICAL**: High-impact issues that create significant security risks and should be addressed immediately
- **HIGH**: Important issues that should be addressed as soon as possible
- **MEDIUM**: Issues that should be addressed as part of a security improvement plan
- **LOW**: Minor issues that could improve security posture
- **INFO**: Informational findings with no immediate security impact

### Report Sections

#### Summary Statistics

This section shows:
- Total number of checks performed
- Pass rate (percentage of checks passed)
- Statistics by severity level
- Statistics by assessment area

#### Priority Findings

This section highlights the most critical security issues that need attention, sorted by severity.

#### AI-Powered Recommendations

This section provides context-aware recommendations generated by analyzing anonymized assessment data:
- Detailed explanation of security risks
- Implementation steps with specific actionable guidance
- Effort level required (Low, Medium, High)
- Security impact of implementing the recommendation (Low, Medium, High)
- Prioritized by importance and impact

The recommendations are generated using external AI assistance while ensuring your tenant data remains private through robust anonymization.

#### Detailed Findings

The detailed sections include:
- Test name and description
- Current configuration
- Recommended configuration
- Reference links to Microsoft documentation

## Taking Action on Findings

For each failed check, TenetSec provides specific recommendations to improve your security posture:

1. Review the priority findings first, focusing on CRITICAL and HIGH severity issues
2. For each issue, review the current configuration details
3. Implement the recommended changes using the Microsoft 365 admin center or PowerShell
4. Use the reference links to Microsoft documentation for detailed guidance
5. After making changes, run the assessment again to verify improvements

### Common Security Improvements

#### Identity & Access Management
- Enable MFA for all users, especially administrators
- Block legacy authentication protocols
- Implement Conditional Access policies
- Use Privileged Identity Management for admin accounts

#### Defender for Office 365
- Configure Safe Attachments and Safe Links
- Implement anti-phishing policies
- Set up security alerts

#### Exchange Online
- Configure email authentication (SPF, DKIM, DMARC)
- Set up mail flow rules for security
- Enable auditing

#### SharePoint & OneDrive
- Restrict external sharing
- Implement access controls for unmanaged devices
- Apply Data Loss Prevention policies

#### Teams
- Configure external access policies
- Restrict guest permissions
- Set secure meeting policies

## Continuous Security Monitoring

For best results:
1. Run TenetSec assessments regularly (monthly or quarterly)
2. Compare results over time to track improvements
3. Stay updated on new security features in Microsoft 365
4. Reassess after major changes to your environment

## Advanced Usage

### API Customization

If you need to customize API calls or add specific checks, you can extend the assessment modules:

1. Create a custom assessment class that inherits from `AssessmentBase`
2. Register your custom checks in the `_register_checks` method
3. Add the custom assessment to the list of assessments to run

### Automating Assessments

You can automate TenetSec runs using scheduling tools:

- Use cron on Linux/macOS or Task Scheduler on Windows
- Set up a continuous integration pipeline
- Store reports with timestamps to track changes over time

## Troubleshooting

### API Permission Issues

If you see "Access denied" or permission-related errors:
1. Review the permissions granted to your app registration
2. Ensure you've granted admin consent for all permissions
3. Verify that the client secret is still valid and not expired
4. Run with debug mode to get more detailed logs:

```bash
python -m tenetsec.main --debug
```

### Rate Limiting

Microsoft Graph API has rate limits. If you hit them:
1. Reduce the scope of your assessment (run fewer modules at once)
2. Add delays between API calls if modifying the code
3. Run during off-peak hours

### Report Generation Issues

If you have problems with reports:
1. Ensure you have write access to the output directory
2. Check that all dependencies are installed correctly
3. For HTML reports, verify that matplotlib and seaborn are working properly